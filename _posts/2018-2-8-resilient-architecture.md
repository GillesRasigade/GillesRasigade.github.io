---


---

<hr>
<p>layout: post<br>
title: Resilient architecture<br>
categories:</p>
<ul>
<li>software-development<br>
date: 2018-02-08</li>
</ul>
<hr>
<p>Building services with resilience is the new key of software development.</p>
<h2 id="principles">Principles</h2>
<p>Few principles might help a lot building resilient architectures. The first one is the <em>Event-Driven Architecture</em> where circuit breaker are managing the pressure on the platform. With this architecture, non critical processes can be delayed until system goes green and circuit breaker are in charge to dilute input requests to backward services.</p>
<h3 id="idempotency">Idempotency</h3>
<p>The first rule to implement on any action of your system is idempotency. Idempotency is the mechanism that makes that the reception of the same action several times are leading to the exact same state.</p>
<p>Make your payload unique, one from each other, with uniquely structures or <em>universal unique id</em>. This is true for your HTTP Requests as well as any message published on message brokers. Ensure this assertion true from the very first line of your code to the last one.</p>
<h3 id="fail-fast">Fail fast</h3>
<p>As the availability of a system is given by <sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup>:</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mi>V</mi><mi>A</mi><mi>I</mi><mi>L</mi><mi>A</mi><mi>B</mi><mi>I</mi><mi>L</mi><mi>I</mi><mi>T</mi><mi>Y</mi><mo>=</mo><mfrac><mrow><mi>M</mi><mi>T</mi><mi>T</mi><mi>F</mi></mrow><mrow><mi>M</mi><mi>T</mi><mi>T</mi><mi>F</mi><mo>+</mo><mi>M</mi><mi>T</mi><mi>T</mi><mi>R</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> AVAILABILITY = \frac{MTTF}{MTTF + MTTR}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 1.36033em;"></span><span class="strut bottom" style="height: 2.12966em; vertical-align: -0.76933em;"></span><span class="base"><span class="mord mathit">A</span><span class="mord mathit" style="margin-right: 0.22222em;">V</span><span class="mord mathit">A</span><span class="mord mathit" style="margin-right: 0.07847em;">I</span><span class="mord mathit">L</span><span class="mord mathit">A</span><span class="mord mathit" style="margin-right: 0.05017em;">B</span><span class="mord mathit" style="margin-right: 0.07847em;">I</span><span class="mord mathit">L</span><span class="mord mathit" style="margin-right: 0.07847em;">I</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.22222em;">Y</span><span class="mrel">=</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.36033em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.10903em;">M</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mbin">+</span><span class="mord mathit" style="margin-right: 0.10903em;">M</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line hide-tail" style="height: 0.04em;"><svg width="400em" height="400em" viewBox="0 0 400000 400000" preserveAspectRatio="xMinYMin slice"><path d="M0 0 h400000 v400000 h-400000z M0 0 h400000 v400000 h-400000z"></path></svg></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.10903em;">M</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">F</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.76933em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p>
<p>where <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mi>T</mi><mi>T</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">MTTF</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.10903em;">M</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">F</span></span></span></span></span> is the mean time to failure and <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mi>T</mi><mi>T</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">MTTR</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.10903em;">M</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span></span></span></span></span> is the mean time to recovery ; it is important to recover blazing fast and thus send failure fast in order to the supervision layer to boot new services as soon as possible.</p>
<p>In other words, crash fast. Do not retry requests in failure but answer fast that you failed. This is allowing the client of your service to find quickly the most efficient fallback or to fail fast in turn.</p>
<p>If you lose connection to a critical service such as your database or message broker: crash.</p>
<h3 id="concurrence">Concurrence</h3>
<p>This is a consequence of the <em>idempotency</em> principle, duplicating the same action on several systems is drastically reducing the <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mi>T</mi><mi>T</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">MTTF</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.10903em;">M</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span><span class="mord mathit" style="margin-right: 0.13889em;">F</span></span></span></span></span>. The same action must then lead to the same result.</p>
<h3 id="fault-tolerance">Fault tolerance</h3>
<p>In some situations, data available in different systems are not consistent. There, reconciliation algorithms such as byzantine fault tolerance <sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> algorithms are required to choose the correct response value and identify possible service in error.</p>
<h3 id="health-check">health check</h3>
<p>Because your service is deployed in a modern supervised system, it must be monitored efficiently. The most evident way to do this for web servers is to expose a non authenticated route at the root level <code>/heartbeat</code> or <code>/healtz</code>, and simply answer the HTTP status code 200.</p>
<p>For workers, updating regularly a file and checking its last updated date will allow you to check that your system is still alive.</p>
<hr>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p><a href="https://www.slideshare.net/ufried/patterns-of-resilience">Patterns of resilience</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p><a href="https://en.wikipedia.org/wiki/Byzantine_fault_tolerance">Byzantine fault tolerance</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>

